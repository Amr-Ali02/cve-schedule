Sub macro1()
'create Current OD Matrix
Dim i As Long
For i = 1 To 10
For j = 1 To 10
Cells(i, j) = Rnd() * 1000
Next j
Next i
'Create Future Production Vector
For i = 1 To 10
Cells(i, 12) = Rnd() * 10000
Next i
'Create Future Atrrction Vector
For j = 1 To 10
Cells(12, j) = Rnd() * 10000
Next j
'Summtion of future production = future attraction
'sum production
Dim sump As Double
sump = 0
For i = 1 To 10
sump = sump + Cells(i, 12)
Next i
Cells(11, 12).Value = sump
'sum attraction
Dim suma As Double
suma = 0
For j = 1 To 10
suma = suma + Cells(12, j)
Next j
Cells(12, 11).Value = suma
'adj factor
Dim adj As Double
adj = sump / suma
'adjust future attraction values
For j = 1 To 10
Cells(13, j).Value = adj * Cells(12, j).Value
Next j
'check sum attraction
suma = 0
For j = 1 To 10
suma = suma + Cells(13, j)
Next j
Cells(13, 11).Value = suma

'================'

'intially all b's =1
Dim bold(9) As Double
For i = 1 To 10
bold(i - 1) = 1
Next i

'sumbe = bi*ei b's * elements sum horizontally
'a's = pi/sumbei
Dim anew(9) As Double
Dim sumbe As Double
sumbe = 0

For i = 1 To 10
For j = 1 To 10
sumbe = sumbe + bold(j - 1) * Cells(i, j)
Next j
anew(i - 1) = Cells(i, 12) / sumbe
Next i
sumbe = 0
'store a's in old vector to compare later
Dim aold(9) As Double
For i = 1 To 10
aold(i - 1) = anew(i - 1)
Next i
'sumae = ai*ei b's * elements sum verticall
'b's = Ai/sumaei
Dim sumae As Double
sumae = 0
Dim bnew(9) As Variant
' i've b old and a old now let's get new for them to compare



Dim cond As Boolean
cond = True
' # problem # Loop Not working'

Do While cond
cond = False

For i = 1 To 10
For j = 1 To 10
sumae = sumae + aold(j - 1) * Cells(j, i)  'move vertically
Next j
bnew(i - 1) = Cells(13, i) / sumae         'get b's
Next i
sumae = 0
'check converge
For i = 1 To 10
If Abs((bnew(i - 1) - bold(i - 1)) / bold(i - 1) * 100) > 5 Then
cond = True
End If
Next i

' let's swap it
For i = 1 To 10
bold(i - 1) = bnew(i - 1)
Next i

For i = 1 To 10
For j = 1 To 10
sumbe = sumbe + bold(j - 1) * Cells(i, j)   'move horizontally
Next j
anew(i - 1) = Cells(i, 12) / sumbe          ' get a's
Next i
sumbe = 0

For i = 1 To 10
If Abs((anew(i - 1) - aold(i - 1)) / aold(i - 1) * 100) > 5 Then
cond = True
End If
Next i

' let's swap it
For i = 1 To 10
aold(i - 1) = anew(i - 1)
Next i

Loop

Cells(1, 15).Value = "a"
Cells(1, 16).Value = "b"
For i = 1 To 10
Cells(i + 1, 15).Value = anew(i - 1)
Cells(i + 1, 16).Value = bnew(i - 1)
Next i

' check a*b*e = o & A
For i = 1 To 10
For j = 1 To 10
Cells(i, 19 + j) = Cells(i, j) * anew(i - 1) * bnew(j - 1)
' move horizontal
Next j
Next i

End Sub

